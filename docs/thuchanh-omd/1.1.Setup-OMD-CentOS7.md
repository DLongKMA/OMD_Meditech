## Cài đặt OMD - Check MK trên CentOS 7

#### Menu

- [1. Mô hình triển khai](#1)
- [2. Cài đặt trên Server](#2)
    - [2.1 Tải file cài đặt OMD - Check MK](#21)
    - [2.2 Cài đặt repo EPEL](#22)
    - [2.3  Cài đặt OMD - Check MK](#23)
    - [2.3  Cài đặt OMD - Check MK](#23)
- [3. Tham khảo)(#3)

### 1. Mô hình triển khai

#### Mô hình triển khai

<img src="../../images/omd-topo.png" width="80%" />

#### IP Planning

Hostname | OS | Service | IP | Netmask | Gateway | DNS | CPU (Core) | RAM (GB) | DISK (GB) |
-|-|-|-|-|-|-|-|-|-|
omd | CentOS 7 | check_mk | 192.168.100.131 | 255.255.255.0 | 192.168.100.1 | 8.8.8.8 | 1 | 2 | 20 |
host-01 | CentOS 7 | httpd | 192.168.100.132 | 255.255.255.0 | 192.168.100.1 | 8.8.8.8 | 1 | 2 | 20 |

### 2. Cài đặt trên Server

#### 2.1. Tải file cài đặt OMD - Check MK

```
wget https://mathias-kettner.de/support/1.2.8p21/check-mk-raw-1.2.8p21-el7-44.x86_64.rpm
```

<img src="../../images/c7-1-download.png" />

#### 2.2. Cài đặt repo EPEL

`Check MK` cần khá nhiều các gói dependence đi kèm, vì thế chúng ta cài đặt thêm gói repo này để có thể đáp ứng được một số gói mà local repo không cung cấp.

```
yum install -y epel-release
```

Sau khi cài đặt `epel-release` xong, chúng ta sẽ được kết quả như hình.

<img src="../../images/c7-2-epel.png" />

#### 2.3. Cài đặt OMD - Check MK

Chúng ta sử dụng `yum` để cài đặt gói RPM, mục đích là để yum 'hoàn thiện' những gói dependence mà `check mk` cần.

```
yum install -y check-mk-raw-1.2.*
```

Chờ cho server tự động cài đặt khoảng 5p, chúng ta thấy kết quả như sau

<img src="../../images/c7-2-yuml.png" />

#### 2.4. Tạo và khởi động site trên OMD

- **Bước 1**: Tạo site

```
omd create site1
```

**Chú ý**: `site1` là tên tùy chọn, bạn có thể đặt bất cứ tên gì bạn muốn

<img src="../../images/c7-4-create-site.png" />

Thông tin `site` được mô tả ở hình.
   
- **Bước 2**: Khởi động site

```
omd start site1
```

<img src="../../images/c7-4-active-site.png" />

- **Bước 3:** Mở port 80 cho HTTPD trên Firewalld

Nếu server của bạn có sử dụng Firewalld, hãy mở port cho httpd bằng lệnh:

```
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --reload
```

- **Bước 4:** Tắt SELinux 

Tắt tức thời bằng lệnh:

```
setenforce 0
```

Chỉnh sửa file cấu hình của SELinux:

```
vi /etc/sysconfig/selinux
```

Sửa dòng `SELINUX=enforcing` thành `SELINUX=disable`.


- **Bước 5**: Kiểm tra bằng trình duyệt Web

Dùng trình duyệt truy cập vào địa chỉ

```
http://192.168.100.131/site1
```

**Chú ý**: Thay địa chỉ IP của bạn vào đường dẫn và đăng nhập theo `omdadmin/omd`

<img src="../../images/c7-webui1.png" />

<img src="../../images/c7-webui2.png" />

### 3. Tham khảo

Script cài đặt: [Xem chi tiết](https://gist.github.com/hoangdh/f5894b682d984a9d7e8f4818d63fcc0c)